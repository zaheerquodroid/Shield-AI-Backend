pattern_id: csec_19_debug_default_true
name: "DEBUG Defaults to True"
category: information_disclosure
severity: critical
description: |
  Detects Django DEBUG setting that defaults to True when environment variable
  is not set. This is a security risk as DEBUG=True in production exposes:
  - Full stack traces with code snippets
  - SQL queries and database information
  - Environment variables and settings
  - Internal file paths and system information

  DEBUG should default to False for security.

jira_reference:
  ticket: CSEC-19
  epic: CSEC-1
  project: "Coco TestAI Security Remediation"

detection:
  # Python patterns for DEBUG setting
  python:
    - pattern: 'DEBUG\s*=\s*os\.environ\.get\(["\']DEBUG["\']\s*,\s*["\']?True["\']?\)'
      description: "DEBUG with True string fallback"
      example: "DEBUG = os.environ.get('DEBUG', 'True')"

    - pattern: 'DEBUG\s*=\s*os\.environ\.get\(["\']DEBUG["\']\s*,\s*True\)'
      description: "DEBUG with boolean True fallback"
      example: "DEBUG = os.environ.get('DEBUG', True)"

    - pattern: 'DEBUG\s*=\s*os\.getenv\(["\']DEBUG["\']\s*,\s*["\']?True["\']?\)'
      description: "DEBUG with os.getenv and True fallback"
      example: "DEBUG = os.getenv('DEBUG', 'True')"

    - pattern: 'DEBUG\s*=\s*os\.environ\.get\(["\']DEBUG["\']\)\s*or\s*["\']?True["\']?'
      description: "DEBUG with or True fallback"
      example: "DEBUG = os.environ.get('DEBUG') or True"

    - pattern: 'DEBUG\s*=\s*os\.environ\.get\(["\']DEBUG["\']\s*,\s*["\']1["\']\)'
      description: "DEBUG with '1' string fallback"
      example: "DEBUG = os.environ.get('DEBUG', '1')"

file_patterns:
  - "**/*settings*.py"      # Django settings
  - "**/*config*.py"        # Flask/FastAPI config

risk_assessment:
  impact: critical
  exploitability: high
  affected_scope: production_security
  labels:
    - P0-Critical
    - security
    - backend
    - extension-launch

  risks:
    - "Exposes full stack traces to attackers"
    - "Reveals SQL queries and database structure"
    - "Leaks environment variables and secrets"
    - "Shows internal file paths and code"
    - "Enables Django Debug Toolbar in production"

fix_strategy:
  approach: single_phase
  breaking_change: false
  description: "Change default to False - safe and non-breaking"

  phases:
    - name: fix
      duration_days: 0
      description: "Change DEBUG default to False immediately"

acceptance_criteria:
  - "DEBUG defaults to False when env var is not set"
  - ".env.dev.example explicitly sets DEBUG=True for development"
  - ".env.prod.example sets DEBUG=False or omits it"
  - "All environments tested (dev, staging, prod)"

estimated_effort:
  detection: "2 minutes"
  fix_application: "15 minutes per codebase"
  testing: "30 minutes"
  total: "1.5 hours per codebase"

notes: |
  This is a simpler fix than CSEC-18 because:
  - No phased migration needed
  - Default to False is always safe
  - Non-breaking (developers explicitly set DEBUG=True in .env for local dev)
  - Single change, immediate deployment
